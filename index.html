
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SWIFT Message Sender</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f4f4f4; }
    h2 { color: #2c3e50; }
    select, input, textarea, button {
      margin: 8px 0; padding: 8px; width: 100%; box-sizing: border-box;
    }
    .row { display: flex; gap: 20px; }
    .col { flex: 1; }
    textarea { height: 120px; }
    .output { background: #fff; padding: 12px; border: 1px solid #ccc; white-space: pre-wrap; }
    button { background: #2980b9; color: white; border: none; cursor: pointer; }
    button:hover { background: #3498db; }
  </style>
</head>
<body>

<h2>SWIFT Message Sender (MT103 / MT199 / MT700 / MT760 / ...)</h2>

<label for="mt_type">Message Type</label>
<select id="mt_type" onchange="loadFields()">
  <option>MT103</option>
  <option>MT199</option>
  <option>MT799</option>
  <option>MT999</option>
  <option>MT700</option>
  <option>MT760</option>
  <option>MT542</option>
  <option>RWA</option>
</select>

<div id="form_fields"></div>

<button onclick="generateSwift()">Generate SWIFT</button>
<button onclick="sendPayment()">Send Payment</button>

<h3>Generated SWIFT Message</h3>
<div id="swift_output" class="output">-- waiting --</div>

<h3>Bank Response</h3>
<div id="bank_response" class="output">-- response will appear here --</div>

<script>
const schemas = {
  MT103: ["sender_account", "sender_name", "receiver_account", "receiver_name", "currency", "amount", "charges", "value_date", "details"],
  MT199: ["subject", "body"],
  MT799: ["body"],
  MT999: ["body"],
  MT700: ["applicant", "beneficiary", "date_of_issue", "currency", "amount", "available_with", "additional_conditions"],
  MT760: ["applicant", "beneficiary", "contract_ref", "currency", "amount", "details"],
  MT542: ["instruction_code", "account_with", "party", "details"],
  RWA: ["body"]
};

function loadFields() {
  const type = document.getElementById("mt_type").value;
  const container = document.getElementById("form_fields");
  container.innerHTML = "";
  schemas[type].forEach(field => {
    const label = document.createElement("label");
    label.textContent = field;
    const input = document.createElement(field === "body" || field === "details" ? "textarea" : "input");
    input.id = field;
    container.appendChild(label);
    container.appendChild(input);
  });
}

async function generateSwift() {
  const type = document.getElementById("mt_type").value;
  const payload = {};
  schemas[type].forEach(f => payload[f] = document.getElementById(f)?.value || "");
  const res = await fetch("/generate_swift", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ type, payload })
  });
  const data = await res.json();
  document.getElementById("swift_output").textContent = data.swift_message || data.error;
}

async function sendPayment() {
  const account_id = prompt("Enter your account_id:");
  const currency = document.getElementById("currency")?.value || "USD";
  const amount = document.getElementById("amount")?.value || "1000.00";
  const recipient = {
    name: document.getElementById("receiver_name")?.value || "Receiver",
    account: document.getElementById("receiver_account")?.value || "IBAN000000"
  };
  const res = await fetch("/send_payment", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      account_id, currency, amount,
      description: "SWIFT Payment",
      recipient
    })
  });
  const data = await res.json();
  document.getElementById("bank_response").textContent = JSON.stringify(data, null, 2);
}

window.onload = loadFields;
</script>

</body>
</html>
